<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Alumnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f5f5; }
        .search-bar { margin: 20px 0; }
        .table thead { background: #3b5998; color: #fff; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <a class="btn btn-secondary mb-3" href="index.html">
            <i class="bi bi-arrow-left"></i> Volver a Ficha Alumno
        </a>
        <h2>Listado de Alumnos</h2>
        <div class="row search-bar">
            <div class="col-md-4">
                <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre o RUT...">
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary" id="reloadBtn">Recargar</button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-striped" id="alumnosTable">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>RUT</th>
                        <th>Fecha de Nacimiento</th>
                        <th>Teléfono Titular</th>
                        <th>Teléfono Suplente</th>
                    </tr>
                </thead>
                <tbody id="alumnosBody">
                    <!-- Aquí se insertan los alumnos -->
                </tbody>
            </table>
        </div>
    </div>
    <script>
        let alumnos = [];

        async function cargarAlumnos() {
            const res = await fetch('http://localhost:5000/api/alumnos');
            alumnos = await res.json();
            alumnos = alumnos.reverse().slice(0, 40); // últimos 40
            mostrarAlumnos(alumnos);
        }

        function mostrarAlumnos(lista) {
            const tbody = document.getElementById('alumnosBody');
            tbody.innerHTML = '';
            lista.forEach(alumno => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${alumno.nombre}</td>
                    <td>${alumno.rut}</td>
                    <td>${alumno.fecha_nacimiento || ''}</td>
                    <td>${alumno.titphone || ''}</td>
                    <td>${alumno.supphone || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById('searchInput').addEventListener('input', function() {
            const filtro = this.value.toLowerCase();
            const filtrados = alumnos.filter(a =>
                (a.nombre && a.nombre.toLowerCase().includes(filtro)) ||
                (a.rut && a.rut.toLowerCase().includes(filtro))
            );
            mostrarAlumnos(filtrados);
        });

        document.getElementById('reloadBtn').addEventListener('click', cargarAlumnos);

        cargarAlumnos();
    </script>
</body>
</html>